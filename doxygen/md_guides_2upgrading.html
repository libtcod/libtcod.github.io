<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-772NXFFJ4E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-772NXFFJ4E');
  </script>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.15.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>libtcod: Upgrading</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
  </script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
    <div id="top">
      <!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">libtcod
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_guides_2upgrading.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Upgrading </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md56"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md57"></a>
Porting to 1.19</h1>
<p>Any new project should use the getting-started guide so that they can start using contexts right way. Older projects will have to convert to contexts over a series of steps.</p>
<p>The old way of initializing a global state with <a class="el" href="console__init_8h.html#ad5631d6218b75572a8e991d29c11c9b4" title="Initialize the libtcod graphical engine.">TCOD_console_init_root()</a> or <a class="el" href="class_t_c_o_d_console.html#a62995995a3e61210697f1ee72ece387b" title="static void TCODConsole::initRoot(int w, int h, string title) static void TCODConsole::initRoot(int w...">TCODConsole::initRoot()</a> has been deprecated. These have been replaced with a public context object.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md58"></a>
New tileset API</h2>
<p>You can switch away from TCOD_console_set_custom_font before using contexts by using the TCOD_set_default_tileset function.</p>
<div class="fragment"><div class="line"><span class="comment">// The old way to load tilesets:</span></div>
<div class="line"><span class="comment">// TCOD_console_set_custom_font(&quot;terminal8x8_gs_tc.png&quot;, TCOD_FONT_LAYOUT_TCOD, 32, 8);</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can update old code to use this new method of loading tilesets before using contexts properly.</span></div>
<div class="line"><span class="keyword">auto</span> tileset = <a class="code hl_function" href="group___tileset___c_p_p.html#gab194c5d896f67f3e99786a00ad0b6afc">tcod::load_tilesheet</a>(<span class="stringliteral">&quot;terminal8x8_gs_tc.png&quot;</span>, {32, 8}, tcod::CHARMAP_TCOD);</div>
<div class="line"><a class="code hl_function" href="globals_8h.html#a85de399c5b7c5ba4d614a2b0dfab4be4">TCOD_set_default_tileset</a>(tileset.get());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This is deprecated, but will work with the above tileset.</span></div>
<div class="line"><a class="code hl_function" href="console__init_8h.html#ad5631d6218b75572a8e991d29c11c9b4">TCOD_console_init_root</a>(80, 25, <span class="stringliteral">&quot;Window title&quot;</span>, <span class="keyword">true</span>, <a class="code hl_enumvalue" href="console__types_8h.html#a875d34dae7188cfc93d4fecf5f93f208a645768b062c7ad2cc67cc8d28ed121d6">TCOD_RENDERER_OPENGL2</a>);</div>
<div class="ttc" id="aconsole__init_8h_html_ad5631d6218b75572a8e991d29c11c9b4"><div class="ttname"><a href="console__init_8h.html#ad5631d6218b75572a8e991d29c11c9b4">TCOD_console_init_root</a></div><div class="ttdeci">TCOD_Error TCOD_console_init_root(int w, int h, const char *title, bool fullscreen, TCOD_renderer_t renderer)</div><div class="ttdoc">Initialize the libtcod graphical engine.</div></div>
<div class="ttc" id="aconsole__types_8h_html_a875d34dae7188cfc93d4fecf5f93f208a645768b062c7ad2cc67cc8d28ed121d6"><div class="ttname"><a href="console__types_8h.html#a875d34dae7188cfc93d4fecf5f93f208a645768b062c7ad2cc67cc8d28ed121d6">TCOD_RENDERER_OPENGL2</a></div><div class="ttdeci">@ TCOD_RENDERER_OPENGL2</div><div class="ttdoc">A new OpenGL 2.0 core renderer.</div><div class="ttdef"><b>Definition</b> console_types.h:551</div></div>
<div class="ttc" id="aglobals_8h_html_a85de399c5b7c5ba4d614a2b0dfab4be4"><div class="ttname"><a href="globals_8h.html#a85de399c5b7c5ba4d614a2b0dfab4be4">TCOD_set_default_tileset</a></div><div class="ttdeci">void TCOD_set_default_tileset(TCOD_Tileset *tileset)</div><div class="ttdoc">Set the default tileset and update the default display to use it.</div></div>
<div class="ttc" id="agroup___tileset___c_p_p_html_gab194c5d896f67f3e99786a00ad0b6afc"><div class="ttname"><a href="group___tileset___c_p_p.html#gab194c5d896f67f3e99786a00ad0b6afc">tcod::load_tilesheet</a></div><div class="ttdeci">auto load_tilesheet(const std::filesystem::path &amp;path, const std::array&lt; int, 2 &gt; &amp;columns_rows, const ArrayType &amp;charmap) -&gt; Tileset</div><div class="ttdoc">Load a tilesheet from a PNG file.</div><div class="ttdef"><b>Definition</b> tileset.hpp:190</div></div>
</div><!-- fragment --><p>Later when you upgrade to contexts you will replace TCOD_set_default_tileset with <a class="el" href="struct_t_c_o_d___context_params.html" title="A struct of parameters used to create a new context with TCOD_context_new.">TCOD_ContextParams</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> params = <a class="code hl_struct" href="struct_t_c_o_d___context_params.html">TCOD_ContextParams</a>{};</div>
<div class="line">params.<a class="code hl_variable" href="struct_t_c_o_d___context_params.html#a482f4c63de6d81749d7bc185eadb5650">tcod_version</a> = <a class="code hl_define" href="version_8h.html#a150b93ec081696d8a006726846465b6a">TCOD_COMPILEDVERSION</a>;  <span class="comment">// This is required.</span></div>
<div class="line">params.columns = 80;</div>
<div class="line">params.rows = 25;</div>
<div class="line">params.tileset = tileset.get();</div>
<div class="line">params.vsync = 1;</div>
<div class="line">params.sdl_window_flags = SDL_WINDOW_RESIZABLE;</div>
<div class="line">params.window_title = <span class="stringliteral">&quot;Window title&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> context = <a class="code hl_function" href="namespacetcod.html#a70fbaeda83162a8cc86f69a94da7cbbb">tcod::new_context</a>(params);</div>
<div class="ttc" id="anamespacetcod_html_a70fbaeda83162a8cc86f69a94da7cbbb"><div class="ttname"><a href="namespacetcod.html#a70fbaeda83162a8cc86f69a94da7cbbb">tcod::new_context</a></div><div class="ttdeci">auto new_context(const TCOD_ContextParams &amp;params, TCOD_Error &amp;out_code) -&gt; ContextPtr</div><div class="ttdoc">Initialize and return a new libtcod context.</div><div class="ttdef"><b>Definition</b> context_init.h:77</div></div>
<div class="ttc" id="astruct_t_c_o_d___context_params_html"><div class="ttname"><a href="struct_t_c_o_d___context_params.html">TCOD_ContextParams</a></div><div class="ttdoc">A struct of parameters used to create a new context with TCOD_context_new.</div><div class="ttdef"><b>Definition</b> context.h:70</div></div>
<div class="ttc" id="astruct_t_c_o_d___context_params_html_a482f4c63de6d81749d7bc185eadb5650"><div class="ttname"><a href="struct_t_c_o_d___context_params.html#a482f4c63de6d81749d7bc185eadb5650">TCOD_ContextParams::tcod_version</a></div><div class="ttdeci">int tcod_version</div><div class="ttdoc">Compiled libtcod version for ABI compatiblity with older versions of libtcod.</div><div class="ttdef"><b>Definition</b> context.h:74</div></div>
<div class="ttc" id="aversion_8h_html_a150b93ec081696d8a006726846465b6a"><div class="ttname"><a href="version_8h.html#a150b93ec081696d8a006726846465b6a">TCOD_COMPILEDVERSION</a></div><div class="ttdeci">#define TCOD_COMPILEDVERSION</div><div class="ttdoc">The version of libtcod currently being compiled.</div><div class="ttdef"><b>Definition</b> version.h:60</div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md59"></a>
Using the new console functions</h2>
<p>There is less state with the new functions. Instead of setting colors before calling the print functions you now pass the colors and flags needed for each print call.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">auto</span> WHITE = <a class="code hl_struct" href="structtcod_1_1_color_r_g_b.html">tcod::ColorRGB</a>{255, 255, 255};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_t_c_o_d_console.html">TCODConsole</a>* console = <span class="keyword">new</span> <a class="code hl_class" href="class_t_c_o_d_console.html">TCODConsole</a>(80, 25);  <span class="comment">// Deprecated.</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="group___print_u_t_f8.html#ga891d14e44eec7f7b5ecfb5a5653e5a42">tcod::print</a>(</div>
<div class="line">  *console,  <span class="comment">// Should be a tcod::Console reference, but a TCODConsole reference can be used for these functions.</span></div>
<div class="line">  {0, 0},  <span class="comment">// Coordinates are passed together.</span></div>
<div class="line">  <a class="code hl_function" href="namespacetcod.html#ab167664b720a52efebd8b3bc8a76c727">tcod::stringf</a>(<span class="stringliteral">&quot;%s %s&quot;</span>, <span class="stringliteral">&quot;Hello&quot;</span>, <span class="stringliteral">&quot;world&quot;</span>),  <span class="comment">// Printf-like strings are encapsulated in tcod::stringf.</span></div>
<div class="line">  WHITE,  <span class="comment">// Color parameters are std::optional.</span></div>
<div class="line">  std::nullopt,  <span class="comment">// Passing std::nullopt here leaves the background color unchanged.</span></div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structtcod_1_1_color_r_g_b.html">tcod::ColorRGB</a> bg = <a class="code hl_function" href="group___console.html#ga17185adb7c2bbb7fa83284446802c25e">TCOD_console_get_char_background</a>(TCODConsole::root-&gt;get_data());</div>
<div class="line"><a class="code hl_function" href="group___console___c_p_p.html#ga50d2e5651bc9caaf6b673f6e80e7043a">tcod::draw_rect</a>(</div>
<div class="line">  *TCODConsole::root,  <span class="comment">// TCODConsole::root is deprecated, but can still be passed as a parameter if it&#39;s initialized.</span></div>
<div class="line">  {0, 0, 20, 1},  <span class="comment">// {left, top, width, height}</span></div>
<div class="line">  0x2500,  <span class="comment">// &quot;â”€&quot; BOX DRAWINGS LIGHT HORIZONTAL.  Unicode is expected for character codes.</span></div>
<div class="line">  WHITE,</div>
<div class="line">  bg,</div>
<div class="line">)</div>
<div class="ttc" id="aclass_t_c_o_d_console_html"><div class="ttname"><a href="class_t_c_o_d_console.html">TCODConsole</a></div><div class="ttdoc">Classic turn by turn game loop:TCODConsole::initRoot(80,50,&quot;my game&quot;,false); while (!...</div><div class="ttdef"><b>Definition</b> console.hpp:137</div></div>
<div class="ttc" id="agroup___console___c_p_p_html_ga50d2e5651bc9caaf6b673f6e80e7043a"><div class="ttname"><a href="group___console___c_p_p.html#ga50d2e5651bc9caaf6b673f6e80e7043a">tcod::draw_rect</a></div><div class="ttdeci">void draw_rect(TCOD_Console &amp;console, const std::array&lt; int, 4 &gt; &amp;rect, int ch, std::optional&lt; TCOD_ColorRGB &gt; fg, std::optional&lt; TCOD_ColorRGB &gt; bg, TCOD_bkgnd_flag_t flag=TCOD_BKGND_SET)</div><div class="ttdoc">Fill a region with the given graphic.</div><div class="ttdef"><b>Definition</b> console_drawing.h:182</div></div>
<div class="ttc" id="agroup___console_html_ga17185adb7c2bbb7fa83284446802c25e"><div class="ttname"><a href="group___console.html#ga17185adb7c2bbb7fa83284446802c25e">TCOD_console_get_char_background</a></div><div class="ttdeci">TCOD_color_t TCOD_console_get_char_background(const TCOD_Console *con, int x, int y)</div><div class="ttdoc">Return the background color of a console at x,y.</div></div>
<div class="ttc" id="agroup___print_u_t_f8_html_ga891d14e44eec7f7b5ecfb5a5653e5a42"><div class="ttname"><a href="group___print_u_t_f8.html#ga891d14e44eec7f7b5ecfb5a5653e5a42">tcod::print</a></div><div class="ttdeci">void print(TCOD_Console &amp;console, const std::array&lt; int, 2 &gt; &amp;xy, std::string_view str, std::optional&lt; TCOD_ColorRGB &gt; fg, std::optional&lt; TCOD_ColorRGB &gt; bg, TCOD_alignment_t alignment=TCOD_LEFT, TCOD_bkgnd_flag_t flag=TCOD_BKGND_SET)</div><div class="ttdoc">Print a string to a console.</div><div class="ttdef"><b>Definition</b> console_printing.hpp:75</div></div>
<div class="ttc" id="anamespacetcod_html_ab167664b720a52efebd8b3bc8a76c727"><div class="ttname"><a href="namespacetcod.html#ab167664b720a52efebd8b3bc8a76c727">tcod::stringf</a></div><div class="ttdeci">TCODLIB_END_IGNORE_DEPRECATIONS std::string stringf(const char *format, T... args)</div><div class="ttdoc">Return a formatted string as a std::string object.</div><div class="ttdef"><b>Definition</b> console_printing.hpp:198</div></div>
<div class="ttc" id="astructtcod_1_1_color_r_g_b_html"><div class="ttname"><a href="structtcod_1_1_color_r_g_b.html">tcod::ColorRGB</a></div><div class="ttdoc">A C++ RGB color, used to handle conversions between color types.</div><div class="ttdef"><b>Definition</b> color.hpp:53</div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md60"></a>
Adapting to contexts and a rootless console</h2>
<p>Before initializing a context properly you can access both the context and the root console. This lets you use context methods like <a class="el" href="struct_t_c_o_d___context.html#aaf3fac8e76162f9fbb56d6ef2ce31626" title="Present a console to the display with the provided viewport options.">TCOD_Context::present</a> easily in older code. This also lets you use the root console on functions which can't accept <span class="tt">nullptr</span>.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="console__init_8h.html#ad5631d6218b75572a8e991d29c11c9b4">TCOD_console_init_root</a>(80, 25, <span class="stringliteral">&quot;Window title&quot;</span>, <span class="keyword">true</span>, <a class="code hl_enumvalue" href="console__types_8h.html#a875d34dae7188cfc93d4fecf5f93f208a645768b062c7ad2cc67cc8d28ed121d6">TCOD_RENDERER_OPENGL2</a>);  <span class="comment">// Deprecated.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get a temporary non-owning pointer to the context made by TCOD_console_init_root or TCODConsole::initRoot.</span></div>
<div class="line"><a class="code hl_struct" href="struct_t_c_o_d___context.html">TCOD_Context</a>* context = <a class="code hl_function" href="console__init_8h.html#a4a462fae0e35143c0417f687d7e14a00">TCOD_sys_get_internal_context</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get a temporary non-owning reference to the root console made by TCOD_console_init_root or TCODConsole::initRoot.</span></div>
<div class="line"><a class="code hl_struct" href="struct_t_c_o_d___console.html">TCOD_Console</a>&amp; root_console = *<a class="code hl_function" href="console__init_8h.html#a805d940499a965441bda63866bfb2907">TCOD_sys_get_internal_console</a>();</div>
<div class="line"><span class="comment">// From now on use root_console instead of NULL, make this global if you have to.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Using the root console with the context is similar to calling TCOD_console_flush() with some exceptions.</span></div>
<div class="line">context-&gt;<a class="code hl_function" href="struct_t_c_o_d___context.html#aaf3fac8e76162f9fbb56d6ef2ce31626">present</a>(root_console);  <span class="comment">// Or in C: TCOD_context_present(context, root_console, NULL)</span></div>
<div class="ttc" id="aconsole__init_8h_html_a4a462fae0e35143c0417f687d7e14a00"><div class="ttname"><a href="console__init_8h.html#a4a462fae0e35143c0417f687d7e14a00">TCOD_sys_get_internal_context</a></div><div class="ttdeci">TCOD_Context * TCOD_sys_get_internal_context(void)</div><div class="ttdoc">Return the context being used internally by the old API.</div></div>
<div class="ttc" id="aconsole__init_8h_html_a805d940499a965441bda63866bfb2907"><div class="ttname"><a href="console__init_8h.html#a805d940499a965441bda63866bfb2907">TCOD_sys_get_internal_console</a></div><div class="ttdeci">TCOD_Console * TCOD_sys_get_internal_console(void)</div><div class="ttdoc">Return a pointer to the &quot;root console&quot; used internally by the old API.</div></div>
<div class="ttc" id="astruct_t_c_o_d___console_html"><div class="ttname"><a href="struct_t_c_o_d___console.html">TCOD_Console</a></div><div class="ttdoc">A libtcod console containing a grid of tiles with {ch, fg, bg} information.</div><div class="ttdef"><b>Definition</b> console.h:125</div></div>
<div class="ttc" id="astruct_t_c_o_d___context_html"><div class="ttname"><a href="struct_t_c_o_d___context.html">TCOD_Context</a></div><div class="ttdoc">A rendering context for libtcod.</div><div class="ttdef"><b>Definition</b> context.h:340</div></div>
<div class="ttc" id="astruct_t_c_o_d___context_html_aaf3fac8e76162f9fbb56d6ef2ce31626"><div class="ttname"><a href="struct_t_c_o_d___context.html#aaf3fac8e76162f9fbb56d6ef2ce31626">TCOD_Context::present</a></div><div class="ttdeci">void present(const TCOD_Console &amp;console, const TCOD_ViewportOptions &amp;viewport)</div><div class="ttdoc">Present a console to the display with the provided viewport options.</div><div class="ttdef"><b>Definition</b> context.h:365</div></div>
</div><!-- fragment --><p>Using the context present function like this will break some functions which say they're not compatible with contexts. Most importantly any timing-related functions will need to be updated. See <span class="tt">Timing</span>_ below.</p>
<p>The next step is to actually replace TCOD_console_init_root with contexts.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> root_console = <a class="code hl_class" href="classtcod_1_1_console.html">tcod::Console</a>{80, 25};  <span class="comment">// TCOD_Console&amp; can be replaced with tcod::Console.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> params = <a class="code hl_struct" href="struct_t_c_o_d___context_params.html">TCOD_ContextParams</a>{};</div>
<div class="line">params.<a class="code hl_variable" href="struct_t_c_o_d___context_params.html#a482f4c63de6d81749d7bc185eadb5650">tcod_version</a> = <a class="code hl_define" href="version_8h.html#a150b93ec081696d8a006726846465b6a">TCOD_COMPILEDVERSION</a>;</div>
<div class="line">params.vsync = 1;</div>
<div class="line">params.sdl_window_flags = SDL_WINDOW_RESIZABLE;</div>
<div class="line">params.window_title = <span class="stringliteral">&quot;Window title&quot;</span>;</div>
<div class="line">params.console = root_console.get();  <span class="comment">// Set the window size from the console size.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> context = <a class="code hl_function" href="namespacetcod.html#a70fbaeda83162a8cc86f69a94da7cbbb">tcod::new_context</a>(params);</div>
<div class="line"> </div>
<div class="line">context-&gt;<a class="code hl_function" href="struct_t_c_o_d___context.html#aaf3fac8e76162f9fbb56d6ef2ce31626">present</a>(root_console);</div>
<div class="ttc" id="aclasstcod_1_1_console_html"><div class="ttname"><a href="classtcod_1_1_console.html">tcod::Console</a></div><div class="ttdoc">A managed libtcod console containing a grid of tiles with {ch, fg, bg} information.</div><div class="ttdef"><b>Definition</b> console_types.hpp:80</div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md61"></a>
Window manipulation</h2>
<p>With the temporary context from the previous step or with TCOD_sys_get_sdl_window you can access the <span class="tt">SDL_Window</span> pointer. You use this to replace several window-related functions such as TCOD_console_set_fullscreen, TCOD_console_is_active or TCOD_console_set_window_title. See the <span class="tt">SDL2 window documentation &lt;<a href="https://wiki.libsdl.org/CategoryVideo">https://wiki.libsdl.org/CategoryVideo</a>&gt;</span>_ for what you can do with the <span class="tt">SDL_Window</span> pointer.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="console__init_8h.html#ad5631d6218b75572a8e991d29c11c9b4">TCOD_console_init_root</a>(80, 25, <span class="stringliteral">&quot;Window title&quot;</span>, <span class="keyword">false</span>, <a class="code hl_enumvalue" href="console__types_8h.html#a875d34dae7188cfc93d4fecf5f93f208a645768b062c7ad2cc67cc8d28ed121d6">TCOD_RENDERER_OPENGL2</a>);  <span class="comment">// Deprecated.</span></div>
<div class="line"><a class="code hl_struct" href="struct_t_c_o_d___context.html">TCOD_Context</a>* context = <a class="code hl_function" href="console__init_8h.html#a4a462fae0e35143c0417f687d7e14a00">TCOD_sys_get_internal_context</a>();</div>
<div class="line">SDL_Window* sdl_window = context-&gt;<a class="code hl_function" href="struct_t_c_o_d___context.html#a9de73047bbea6ace9eb147bbc4498dc2">get_sdl_window</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (sdl_window) {</div>
<div class="line">  SDL_SetWindowTitle(sdl_window, <span class="stringliteral">&quot;New title&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (SDL_GetWindowFlags(sdl_window) &amp; SDL_WINDOW_INPUT_FOCUS) {}</div>
<div class="line">}</div>
<div class="ttc" id="astruct_t_c_o_d___context_html_a9de73047bbea6ace9eb147bbc4498dc2"><div class="ttname"><a href="struct_t_c_o_d___context.html#a9de73047bbea6ace9eb147bbc4498dc2">TCOD_Context::get_sdl_window</a></div><div class="ttdeci">auto get_sdl_window() noexcept -&gt; struct SDL_Window *</div><div class="ttdoc">Return a non-owning pointer to the SDL_Window used by this context.</div><div class="ttdef"><b>Definition</b> context.h:395</div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md62"></a>
Event systems</h2>
<p>Libtcod's event systems have been deprecated in favor of using <span class="tt">SDL2</span>_ directly for events. <a class="el" href="struct_t_c_o_d___context.html#a85c26b4b289f8ff9c2a3924256078aae" title="Convert the pixel coordinates of SDL mouse events to the tile coordinates of the current context.">TCOD_Context::convert_event_coordinates</a> is the recommended way to convert pixel coordinates to tiles. <a class="el" href="event_8h.html#aa35a369c1f67c6542eb03b8394e282c8" title="Parse an SDL_Event into a key event and return the relevant TCOD_event_t.">tcod::sdl2::process_event</a> might work better for converting old code to use the new system.</p>
<div class="fragment"><div class="line"><span class="comment">// tcod::ContextPtr context = tcod::new_context(...);  // For code using contexts.</span></div>
<div class="line"><span class="comment">// TCOD_Context* context = TCOD_sys_get_internal_context();  // For code still using the old API.</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">  SDL_Event event;</div>
<div class="line">  <span class="keywordflow">while</span> (SDL_PollEvent(&amp;event)) {</div>
<div class="line">    <span class="comment">// context-&gt;convert_event_coordinates(event);  // Optional, converts mouse pixel coordinates into tile coordinates.</span></div>
<div class="line">    <span class="keywordflow">switch</span> (event.type) {</div>
<div class="line">      <span class="keywordflow">case</span> SDL_QUIT:</div>
<div class="line">        std::exit(EXIT_SUCCESS);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> SDL_KEYDOWN: {</div>
<div class="line">        <a class="code hl_struct" href="struct_t_c_o_d__mouse__t.html">TCOD_mouse_t</a> key;</div>
<div class="line">        <a class="code hl_function" href="event_8h.html#aa35a369c1f67c6542eb03b8394e282c8">tcod::sdl2::process_event</a>(event, key);  <span class="comment">// Convert a SDL key to a libtcod key event, to help port older code.</span></div>
<div class="line">        <span class="keywordflow">switch</span> (event.key.keysym.sym) {</div>
<div class="line">          <span class="keywordflow">case</span> SDLK_EQUALS: <span class="comment">// equals/plus key symbol.</span></div>
<div class="line">            <span class="keywordflow">if</span> (event.key.keysym.mod &amp; KMOD_SHIFT) {</div>
<div class="line">              <span class="comment">// Handle plus key.</span></div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">          <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> SDL_MOUSEBUTTONDOWN: {</div>
<div class="line">        <a class="code hl_struct" href="struct_t_c_o_d__mouse__t.html">TCOD_mouse_t</a> mouse;</div>
<div class="line">        <a class="code hl_function" href="event_8h.html#aa35a369c1f67c6542eb03b8394e282c8">tcod::sdl2::process_event</a>(event, mouse);  <span class="comment">// Convert SDL into a libtcod mouse event, to help port older code.</span></div>
<div class="line">        <span class="comment">// The above expects pixel coordinates.  So you can&#39;t use convert_event_coordinates before process_event.</span></div>
<div class="line">        context-&gt;<a class="code hl_function" href="struct_t_c_o_d___context.html#a85c26b4b289f8ff9c2a3924256078aae">convert_event_coordinates</a>(event);</div>
<div class="line">      } <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aevent_8h_html_aa35a369c1f67c6542eb03b8394e282c8"><div class="ttname"><a href="event_8h.html#aa35a369c1f67c6542eb03b8394e282c8">tcod::sdl2::process_event</a></div><div class="ttdeci">TCOD_event_t process_event(const union SDL_Event &amp;in, TCOD_key_t &amp;out) noexcept</div><div class="ttdoc">Parse an SDL_Event into a key event and return the relevant TCOD_event_t.</div></div>
<div class="ttc" id="astruct_t_c_o_d___context_html_a85c26b4b289f8ff9c2a3924256078aae"><div class="ttname"><a href="struct_t_c_o_d___context.html#a85c26b4b289f8ff9c2a3924256078aae">TCOD_Context::convert_event_coordinates</a></div><div class="ttdeci">void convert_event_coordinates(SDL_Event &amp;event)</div><div class="ttdoc">Convert the pixel coordinates of SDL mouse events to the tile coordinates of the current context.</div><div class="ttdef"><b>Definition</b> context.h:458</div></div>
<div class="ttc" id="astruct_t_c_o_d__mouse__t_html"><div class="ttname"><a href="struct_t_c_o_d__mouse__t.html">TCOD_mouse_t</a></div><div class="ttdoc">Mouse state provided by the libtcod event system.</div><div class="ttdef"><b>Definition</b> mouse_types.h:50</div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md63"></a>
Timing</h2>
<p>All of the libtcod timing functions have been deprecated. Many will stop working once you switch to using contexts. Instead you should use <a class="el" href="classtcod_1_1_timer.html" title="A timing class based on SDL&#39;s high performance time counter.">tcod::Timer</a> and SDL2's timing functions. Remember that you have to add <span class="tt">#include &lt;<a class="el" href="timer_8hpp.html" title="SDL-based frame timing addon.">libtcod/timer.hpp</a>&gt;</span> to access <a class="el" href="classtcod_1_1_timer.html" title="A timing class based on SDL&#39;s high performance time counter.">tcod::Timer</a>, this also requires the SDL2 headers.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> desired_fps = 30;</div>
<div class="line"><span class="keyword">auto</span> timer = <a class="code hl_class" href="classtcod_1_1_timer.html">tcod::Timer</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (1) {</div>
<div class="line">  uint32_t current_time_ms = SDL_GetTicks();</div>
<div class="line">  <span class="keywordtype">float</span> current_time = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(current_time_ms) / 1000.f;</div>
<div class="line">  <span class="keywordtype">float</span> delta_time = timer.sync(desired_fps);</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="ttc" id="aclasstcod_1_1_timer_html"><div class="ttname"><a href="classtcod_1_1_timer.html">tcod::Timer</a></div><div class="ttdoc">A timing class based on SDL&#39;s high performance time counter.</div><div class="ttdef"><b>Definition</b> timer.hpp:70</div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md64"></a>
Switching to contexts</h2>
<p>With all the above done you can now switch away from TCOD_console_init_root and start using <a class="el" href="struct_t_c_o_d___context_params.html" title="A struct of parameters used to create a new context with TCOD_context_new.">TCOD_ContextParams</a> and <a class="el" href="namespacetcod.html#a70fbaeda83162a8cc86f69a94da7cbbb" title="Initialize and return a new libtcod context.">tcod::new_context</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;libtcod.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SDL2.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div>
<div class="line">  <span class="keyword">auto</span> root_console = <a class="code hl_class" href="classtcod_1_1_console.html">tcod::Console</a>{80, 25};</div>
<div class="line">  <span class="keyword">auto</span> tileset = <a class="code hl_function" href="group___tileset___c_p_p.html#gab194c5d896f67f3e99786a00ad0b6afc">tcod::load_tilesheet</a>(<span class="stringliteral">&quot;terminal8x8_gs_tc.png&quot;</span>, {32, 8}, tcod::CHARMAP_TCOD);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_struct" href="struct_t_c_o_d___context_params.html">TCOD_ContextParams</a> params{};</div>
<div class="line">  params.<a class="code hl_variable" href="struct_t_c_o_d___context_params.html#a482f4c63de6d81749d7bc185eadb5650">tcod_version</a> = <a class="code hl_define" href="version_8h.html#a150b93ec081696d8a006726846465b6a">TCOD_COMPILEDVERSION</a>;</div>
<div class="line">  params.console = root_console.get();</div>
<div class="line">  params.window_title = <span class="stringliteral">&quot;Window title&quot;</span>;</div>
<div class="line">  params.sdl_window_flags = SDL_WINDOW_RESIZABLE;</div>
<div class="line">  params.vsync = <span class="keyword">true</span>;</div>
<div class="line">  params.argc = argc;</div>
<div class="line">  params.argv = argv;</div>
<div class="line">  params.tileset = tileset.get();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> context = <a class="code hl_function" href="namespacetcod.html#a70fbaeda83162a8cc86f69a94da7cbbb">tcod::new_context</a>(params);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span> (1) {</div>
<div class="line">    context-&gt;<a class="code hl_function" href="struct_t_c_o_d___context.html#aaf3fac8e76162f9fbb56d6ef2ce31626">present</a>(root_console);</div>
<div class="line"> </div>
<div class="line">    SDL_Event event;</div>
<div class="line">    <span class="keywordflow">while</span> (SDL_PollEvent(&amp;event)){</div>
<div class="line">      <span class="keywordflow">switch</span> (event.type) {</div>
<div class="line">        <span class="keywordflow">case</span> SDL_QUIT:</div>
<div class="line">          <span class="keywordflow">return</span> 0;  <span class="comment">// Exit.</span></div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md65"></a>
Porting to 1.6</h1>
<p>The largest and most influential change to libtcod, between versions 1.5.2 and 1.6.0, was the move to replace SDL with <span class="tt">SDL2</span>_. SDL2 made many extensive changes to concepts used in SDL. Only one of these changes, the separation of text and key events, required a change in the libtcod API requiring users to update their code in the process of updating the version of libtcod they use.</p>
<p>When a user presses a key, they may be pressing <span class="tt">SHIFT</span> and <span class="tt">=</span>. On some keyboards, depending on the user's language and location, this may show <span class="tt">+</span> on the screen. On other user's keyboards, who knows what it may show on screen. SDL2 changes the way "the text which is displayed on the user's screen" is sent in key events. This means that the key event for <span class="tt">SHIFT</span> and <span class="tt">=</span> will be what happens for presses of both <span class="tt">+</span> and <span class="tt">=</span> (for user's with applicable keyboards), and there will be a new text event that happens with the displayed <span class="tt">+</span>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md66"></a>
In libtcod 1.5.x</h2>
<p>SDL would when sending key events, provide the unicode character for the key event, ready for use. This meant that if the user happened to be using a British keyboard (or any that are similarly laid out), and pressed <span class="tt">SHIFT</span> and <span class="tt">=</span>, the event would be for the character <span class="tt">+</span>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (key-&gt;c == <span class="charliteral">&#39;+&#39;</span>) {</div>
<div class="line">    <span class="comment">// Handle any key that displays a plus.</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md67"></a>
In libtcod 1.6.x</h2>
<p>With SDL2, the raw key-presses still occur, but they are fundamentally linked to the keyboard of the user. Now there will still be an event where it says <span class="tt">SHIFT</span> and <span class="tt">=</span> are pressed, but the event will always be for the unmodified character <span class="tt">=</span>. The unicode text arrives in a new kind of event, and getting it requires explicitly checking that the event is the new text event, and then looking for the value in the relevant <span class="tt">text</span> field for the language being used.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (key-&gt;vk == TCODK_TEXT) {</div>
<div class="line">    <span class="keywordflow">if</span> (key.text[0] == <span class="charliteral">&#39;+&#39;</span>) {</div>
<div class="line">        <span class="comment">// Handle any key that displays a plus.</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md68"></a>
Still confused?</h2>
<p>Run your code from a terminal or DOS window and print out the event attributes/fields and look at what is going on. Have your code print out the modifiers, the keycode, the character, the text, and then run it and try pressing some keys. It will be much faster than posting "I don't understand" or "Can someone explain" somewhere and waiting for a response.</p>
<p>.. _SDL2: <a href="https://www.libsdl.org/index.php">https://www.libsdl.org/index.php</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
